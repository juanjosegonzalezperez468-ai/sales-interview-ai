<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Nueva Vacante | Sales AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 p-4 md:p-8 font-sans">
<div class="max-w-3xl mx-auto">

    <div class="mb-6">
        <a href="/dashboard" class="text-slate-400 hover:text-blue-600 font-bold text-sm transition">â† Volver al Dashboard</a>
    </div>

    <div class="flex items-center gap-3 mb-8">
        <div class="bg-blue-600 p-3 rounded-2xl text-2xl shadow-lg shadow-blue-200">âœ¨</div>
        <h1 class="text-2xl font-black text-slate-800 tracking-tight">Crear Nueva Vacante</h1>
    </div>

    <form method="POST" id="form-vacante" class="space-y-6">

        <!-- Nombre del cargo -->
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
            <label class="block text-[10px] font-black uppercase text-slate-400 mb-2 tracking-widest">Nombre del Cargo</label>
            <input type="text" name="cargo" placeholder="Ej: Ejecutivo de Ventas Senior" required
                   class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none font-bold text-slate-700">
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             STACK DE HABILIDADES CRÃTICAS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
            <div class="flex items-start justify-between mb-1">
                <div>
                    <label class="block text-[10px] font-black uppercase text-slate-400 tracking-widest">Stack de Habilidades CrÃ­ticas</label>
                    <p class="text-xs text-slate-400 mt-1">Selecciona entre 3 y 5. GuiarÃ¡n la evaluaciÃ³n y el score de cada candidato.</p>
                </div>
                <div class="flex items-center gap-1.5 bg-slate-50 border border-slate-200 rounded-xl px-3 py-1.5 shrink-0">
                    <span id="contador-hab" class="text-lg font-black text-slate-300">0</span>
                    <span class="text-xs text-slate-400 font-bold">/ 5</span>
                </div>
            </div>

            <!-- Barra progreso -->
            <div class="flex items-center gap-2 mb-5 mt-3">
                <div class="flex-1 h-1.5 bg-slate-100 rounded-full overflow-hidden">
                    <div id="barra-hab" class="h-full rounded-full transition-all duration-300 bg-slate-200" style="width:0%"></div>
                </div>
                <span class="text-[10px] font-bold text-slate-400 whitespace-nowrap">mÃ­n. 3</span>
            </div>

            <!-- TÃ©cnicas -->
            <p class="text-[10px] font-black uppercase text-slate-300 tracking-widest mb-2">ğŸ§  TÃ©cnicas</p>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-4">
                <button type="button" data-hab="ProspecciÃ³n en FrÃ­o"      onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ¯</span><p class="text-xs font-bold text-slate-600 mt-1">ProspecciÃ³n en FrÃ­o</p></button>
                <button type="button" data-hab="Cierre de Ventas"         onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ¤</span><p class="text-xs font-bold text-slate-600 mt-1">Cierre de Ventas</p></button>
                <button type="button" data-hab="CRM Management"           onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ’»</span><p class="text-xs font-bold text-slate-600 mt-1">CRM Management</p></button>
                <button type="button" data-hab="AnÃ¡lisis de Datos"        onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ“Š</span><p class="text-xs font-bold text-slate-600 mt-1">AnÃ¡lisis de Datos</p></button>
                <button type="button" data-hab="GestiÃ³n de Pipeline"      onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ”„</span><p class="text-xs font-bold text-slate-600 mt-1">GestiÃ³n de Pipeline</p></button>
                <button type="button" data-hab="NegociaciÃ³n"              onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>âš–ï¸</span><p class="text-xs font-bold text-slate-600 mt-1">NegociaciÃ³n</p></button>
                <button type="button" data-hab="Conocimiento de Producto" onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ“¦</span><p class="text-xs font-bold text-slate-600 mt-1">Conocimiento de Producto</p></button>
                <button type="button" data-hab="GestiÃ³n de Cuentas Clave" onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ¢</span><p class="text-xs font-bold text-slate-600 mt-1">GestiÃ³n de Cuentas Clave</p></button>
            </div>

            <!-- Blandas -->
            <p class="text-[10px] font-black uppercase text-slate-300 tracking-widest mb-2">ğŸ¤ Blandas</p>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-4">
                <button type="button" data-hab="ComunicaciÃ³n Persuasiva"  onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ“£</span><p class="text-xs font-bold text-slate-600 mt-1">ComunicaciÃ³n Persuasiva</p></button>
                <button type="button" data-hab="Escucha Activa"           onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ‘‚</span><p class="text-xs font-bold text-slate-600 mt-1">Escucha Activa</p></button>
                <button type="button" data-hab="OrientaciÃ³n a Resultados" onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ“ˆ</span><p class="text-xs font-bold text-slate-600 mt-1">OrientaciÃ³n a Resultados</p></button>
                <button type="button" data-hab="Trabajo en Equipo"        onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ‘¥</span><p class="text-xs font-bold text-slate-600 mt-1">Trabajo en Equipo</p></button>
                <button type="button" data-hab="Liderazgo"                onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ†</span><p class="text-xs font-bold text-slate-600 mt-1">Liderazgo</p></button>
                <button type="button" data-hab="Adaptabilidad"            onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ”€</span><p class="text-xs font-bold text-slate-600 mt-1">Adaptabilidad</p></button>
                <button type="button" data-hab="ResoluciÃ³n de Problemas"  onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ§©</span><p class="text-xs font-bold text-slate-600 mt-1">ResoluciÃ³n de Problemas</p></button>
                <button type="button" data-hab="GestiÃ³n del Tiempo"       onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>â±ï¸</span><p class="text-xs font-bold text-slate-600 mt-1">GestiÃ³n del Tiempo</p></button>
            </div>

            <!-- EstratÃ©gicas -->
            <p class="text-[10px] font-black uppercase text-slate-300 tracking-widest mb-2">ğŸ“ˆ EstratÃ©gicas</p>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 mb-4">
                <button type="button" data-hab="Pensamiento AnalÃ­tico"    onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ§ </span><p class="text-xs font-bold text-slate-600 mt-1">Pensamiento AnalÃ­tico</p></button>
                <button type="button" data-hab="Toma de Decisiones"       onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>âš¡</span><p class="text-xs font-bold text-slate-600 mt-1">Toma de Decisiones</p></button>
                <button type="button" data-hab="PlaneaciÃ³n EstratÃ©gica"   onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸ—ºï¸</span><p class="text-xs font-bold text-slate-600 mt-1">PlaneaciÃ³n EstratÃ©gica</p></button>
                <button type="button" data-hab="GestiÃ³n de Prioridades"   onclick="toggleHab(this)" class="hab-btn text-left px-4 py-3 rounded-2xl border-2 border-slate-100 bg-slate-50 hover:border-blue-200 hover:bg-blue-50 transition-all"><span>ğŸšï¸</span><p class="text-xs font-bold text-slate-600 mt-1">GestiÃ³n de Prioridades</p></button>
            </div>

            <p id="msg-hab" class="text-xs font-bold text-rose-400 mt-2 hidden">âš ï¸ Debes seleccionar al menos 3 habilidades crÃ­ticas.</p>
            <input type="hidden" name="habilidades_seleccionadas" id="habilidades-seleccionadas" value="">
        </div>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             PREGUNTAS CON HABILIDAD ASOCIADA (PASO 3)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div id="contenedor-preguntas" class="space-y-6"></div>

        <div class="space-y-4">
            <button type="button" onclick="agregarPregunta()"
                    class="w-full py-4 border-2 border-dashed border-slate-200 rounded-3xl text-slate-400 font-bold
                           hover:bg-slate-100 hover:border-blue-300 hover:text-blue-500 transition-all">
                + AÃ±adir Pregunta
            </button>
            <div class="sticky bottom-6 pt-4">
                <button type="submit"
                        class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-200
                               hover:bg-blue-700 active:scale-95 transition-all tracking-widest uppercase">
                    Crear y Publicar Vacante
                </button>
            </div>
        </div>
    </form>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SKILL STACK â€” biblioteca de habilidades
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SKILL_STACK = {
    "ğŸ§  TÃ©cnicas": [
        "ProspecciÃ³n en FrÃ­o", "Cierre de Ventas", "CRM Management",
        "AnÃ¡lisis de Datos", "GestiÃ³n de Pipeline", "NegociaciÃ³n",
        "Conocimiento de Producto", "GestiÃ³n de Cuentas Clave"
    ],
    "ğŸ¤ Blandas": [
        "ComunicaciÃ³n Persuasiva", "Escucha Activa", "OrientaciÃ³n a Resultados",
        "Trabajo en Equipo", "Liderazgo", "Adaptabilidad",
        "ResoluciÃ³n de Problemas", "GestiÃ³n del Tiempo"
    ],
    "ğŸ“ˆ EstratÃ©gicas": [
        "Pensamiento AnalÃ­tico", "Toma de Decisiones",
        "PlaneaciÃ³n EstratÃ©gica", "GestiÃ³n de Prioridades"
    ]
};

// Genera <option> agrupadas; marca con â˜… las habilidades crÃ­ticas del rol
function buildHabilidadesOptions(valorActual = '') {
    let html = '<option value="">â€” Sin habilidad asociada â€”</option>';
    for (const [cat, habs] of Object.entries(SKILL_STACK)) {
        html += `<optgroup label="${cat}">`;
        habs.forEach(h => {
            const sel    = h === valorActual ? 'selected' : '';
            const critica = seleccionadas.includes(h) ? ' â˜…' : '';
            html += `<option value="${h}" ${sel}>${h}${critica}</option>`;
        });
        html += '</optgroup>';
    }
    return html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HABILIDADES CRÃTICAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MAX_HAB = 5;
const MIN_HAB = 3;
let seleccionadas = [];

function toggleHab(btn) {
    const hab = btn.dataset.hab;
    const idx = seleccionadas.indexOf(hab);

    if (idx === -1) {
        if (seleccionadas.length >= MAX_HAB) return;
        seleccionadas.push(hab);
        btn.classList.remove('border-slate-100','bg-slate-50','hover:border-blue-200','hover:bg-blue-50');
        btn.classList.add('border-blue-500','bg-blue-50','ring-2','ring-blue-200');
        btn.querySelector('p').classList.replace('text-slate-600','text-blue-700');
    } else {
        seleccionadas.splice(idx, 1);
        btn.classList.add('border-slate-100','bg-slate-50','hover:border-blue-200','hover:bg-blue-50');
        btn.classList.remove('border-blue-500','bg-blue-50','ring-2','ring-blue-200');
        btn.querySelector('p').classList.replace('text-blue-700','text-slate-600');
    }
    actualizarUI();
}

function actualizarUI() {
    const n = seleccionadas.length;

    // Contador
    const contador = document.getElementById('contador-hab');
    contador.textContent = n;
    contador.className = 'text-lg font-black ' + (
        n >= MIN_HAB ? 'text-blue-600' : n > 0 ? 'text-rose-400' : 'text-slate-300'
    );

    // Barra
    const barra = document.getElementById('barra-hab');
    barra.style.width = Math.min((n / MAX_HAB) * 100, 100) + '%';
    barra.className = 'h-full rounded-full transition-all duration-300 ' + (
        n >= MIN_HAB ? 'bg-blue-500' : n > 0 ? 'bg-rose-300' : 'bg-slate-200'
    );

    // Bloquear cuando llega a 5
    document.querySelectorAll('.hab-btn').forEach(b => {
        const bloq = n >= MAX_HAB && !seleccionadas.includes(b.dataset.hab);
        b.classList.toggle('opacity-40', bloq);
        b.classList.toggle('cursor-not-allowed', bloq);
    });

    // Actualizar input oculto
    document.getElementById('habilidades-seleccionadas').value = seleccionadas.join(',');

    // Refrescar â˜… en todos los selects de habilidad
    document.querySelectorAll('.select-habilidad').forEach(sel => {
        const actual = sel.value;
        sel.innerHTML = buildHabilidadesOptions(actual);
    });

    if (n >= MIN_HAB) document.getElementById('msg-hab').classList.add('hidden');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PREGUNTAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function alternarCampos(select) {
    const card = select.closest('.pregunta-card');
    const seccionMultiple = card.querySelector('.seccion-multiple');
    const labelRegla = card.querySelector('.label-regla');
    if (select.value === 'multiple') {
        seccionMultiple.classList.remove('hidden');
        labelRegla.innerText = "Respuesta Correcta (debe ser idÃ©ntica a una opciÃ³n)";
    } else {
        seccionMultiple.classList.add('hidden');
        labelRegla.innerText = "Regla (Ideal / Keywords)";
    }
}

function agregarOpcion(btn) {
    const lista = btn.previousElementSibling;
    if (lista.children.length < 4) {
        const div = document.createElement('div');
        div.className = "flex items-center gap-2";
        div.innerHTML = `
            <input type="text" name="p_opciones_lista[]" placeholder="OpciÃ³n..."
                   class="flex-1 p-2 bg-white border border-slate-200 rounded-lg text-xs outline-none focus:border-blue-400">
            <button type="button" onclick="this.parentElement.remove()" class="text-slate-300 hover:text-rose-500">âœ•</button>`;
        lista.appendChild(div);
    }
}

function agregarPregunta() {
    const contenedor = document.getElementById('contenedor-preguntas');
    const index = contenedor.children.length;

    const div = document.createElement('div');
    div.className = 'pregunta-card bg-white p-6 rounded-3xl shadow-sm border border-slate-100 space-y-4 relative';
    div.innerHTML = `
        <input type="hidden" name="p_id[]" value="q_nueva_${Date.now()}">

        <div class="flex justify-between items-center">
            <span class="text-xs font-black text-blue-600 uppercase tracking-widest">Pregunta #${index + 1}</span>
            <button type="button" onclick="this.closest('.pregunta-card').remove()"
                    class="text-slate-300 hover:text-rose-500 transition font-bold text-lg">âœ•</button>
        </div>

        <!-- Texto -->
        <input type="text" name="p_texto[]" required placeholder="Escribe la pregunta aquÃ­..."
               class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl text-sm outline-none focus:bg-white transition">

        <!-- Tipo + Peso -->
        <div class="grid grid-cols-2 gap-4">
            <select name="p_tipo[]" onchange="alternarCampos(this)"
                    class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl text-sm font-medium">
                <option value="si_no">SÃ­ / No</option>
                <option value="multiple">OpciÃ³n MÃºltiple</option>
                <option value="abierta">Abierta (IA)</option>
            </select>
            <input type="number" name="p_peso[]" placeholder="Peso %"
                   class="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl text-sm">
        </div>

        <!-- â˜… PASO 3: Habilidad que evalÃºa esta pregunta -->
        <div class="bg-blue-50 border border-blue-100 rounded-2xl p-3">
            <label class="block text-[10px] font-black uppercase text-blue-400 mb-1.5 tracking-widest">
                â˜… Habilidad que evalÃºa esta pregunta
                <span class="text-blue-300 normal-case font-normal ml-1">(â˜… = crÃ­tica para este rol)</span>
            </label>
            <select name="habilidad_asociada[]"
                    class="select-habilidad w-full p-2.5 bg-white border border-blue-100 rounded-xl text-sm font-medium
                           focus:ring-2 focus:ring-blue-400 outline-none text-slate-700">
                ${buildHabilidadesOptions()}
            </select>
        </div>

        <!-- Opciones mÃºltiple -->
        <div class="seccion-multiple hidden space-y-3 bg-slate-50 p-4 rounded-2xl border border-slate-100">
            <label class="block text-[10px] font-black uppercase text-slate-400">Opciones (MÃ¡ximo 4)</label>
            <div class="lista-opciones space-y-2"></div>
            <button type="button" onclick="agregarOpcion(this)"
                    class="text-blue-600 text-[10px] font-black uppercase">+ AÃ±adir OpciÃ³n</button>
        </div>

        <!-- Regla -->
        <div class="seccion-regla">
            <label class="label-regla block text-[10px] font-black uppercase text-slate-400 mb-1">Regla (Ideal / Keywords)</label>
            <input type="text" name="p_regla[]" required placeholder="si / no / palabra clave"
                   class="w-full p-3 bg-blue-50 border border-blue-100 rounded-xl text-sm text-blue-700 font-bold">
        </div>

        <!-- KO -->
        <div class="flex items-center gap-2">
            <input type="checkbox" name="p_ko[]" value="${index}" class="w-4 h-4 rounded text-blue-600">
            <label class="text-[10px] font-bold text-rose-500 uppercase">Â¿KO? (Elimina al candidato si falla)</label>
        </div>`;

    contenedor.appendChild(div);
}

window.onload = agregarPregunta;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VALIDACIÃ“N AL ENVIAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('form-vacante').onsubmit = function(e) {

    // 1. MÃ­nimo 3 habilidades crÃ­ticas
    if (seleccionadas.length < MIN_HAB) {
        e.preventDefault();
        document.getElementById('msg-hab').classList.remove('hidden');
        document.querySelector('[data-hab]').scrollIntoView({ behavior: 'smooth', block: 'center' });
        return false;
    }

    // 2. Pesos suman 100
    let total = 0;
    document.getElementsByName('p_peso[]').forEach(p => { total += parseFloat(p.value || 0); });
    if (total !== 100) {
        e.preventDefault();
        alert(`ğŸš¨ La suma de los pesos debe ser exactamente 100%.\nActualmente suma: ${total}%`);
        return false;
    }

    // 3. Sincronizar Ã­ndices KO
    document.querySelectorAll('.pregunta-card').forEach((card, i) => {
        const cb = card.querySelector('input[type="checkbox"]');
        if (cb) cb.value = i;
    });
};
</script>
</body>
</html>