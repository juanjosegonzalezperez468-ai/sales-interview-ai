<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidatos | Sales AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/landing.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* --- ESTILOS ADICIONALES PARA FILTROS Y MODAL --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0; top: 0; 
            width: 100%; height: 100%; 
            background: rgba(15, 23, 42, 0.6); /* Overlay m√°s moderno */
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white; 
            margin: 5% auto; 
            padding: 2.5rem; 
            width: 70%; 
            max-width: 900px; 
            border-radius: 20px; 
            position: relative; 
            max-height: 85vh; 
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-btn {
            position: absolute; right: 25px; top: 15px; 
            font-size: 32px; font-weight: bold; color: var(--gray-400); 
            cursor: pointer; transition: 0.2s;
        }
        .close-btn:hover { color: var(--gray-900); }

        /* Estados visuales del Score */
        .score-high { color: #065f46; background: #d1fae5; border: 1px solid #a7f3d0; }
        .score-medium { color: #92400e; background: #fef3c7; border: 1px solid #fde68a; }
        .score-low { color: #991b1b; background: #fee2e2; border: 1px solid #fecaca; }

        /* Badge de Veredicto */
        .veredicto-badge {
            font-size: 0.75rem; font-weight: 700; padding: 4px 10px; border-radius: 99px; text-transform: uppercase;
        }

        .filters-bar input, .filters-bar select {
            transition: all 0.2s;
            outline: none;
        }
        .filters-bar input:focus, .filters-bar select:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
    </style>
</head>
<body style="background-color: var(--gray-50);">

    <nav class="navbar">
        <div class="container nav-container">
            <a href="/" class="logo">
                <div class="logo-icon">S</div>
                <span>SALES AI</span>
            </a>
            <div class="nav-actions">
                <a href="/dashboard" class="btn-secondary">Volver al Dashboard</a>
            </div>
        </div>
    </nav>

    <header class="page-hero">
        <div class="container">
            <h1>üéØ Centro de Candidatos</h1>
            <p>Filtra, analiza y contacta a los mejores perfiles evaluados por IA.</p>
        </div>
    </header>

    <main class="container" style="margin-top: var(--spacing-xl); margin-bottom: var(--spacing-2xl);">
        
        <div class="filters-bar" style="background: white; padding: 1.25rem; border-radius: 16px; margin-bottom: 1.5rem; display: flex; gap: 1rem; align-items: center; box-shadow: var(--shadow-sm); border: 1px solid var(--gray-200);">
            <div style="flex: 1; position: relative;">
                <input type="text" id="searchInput" onkeyup="aplicarFiltros()" placeholder="üîç Buscar por nombre o identificaci√≥n..." 
                       style="width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--gray-200); border-radius: 10px; font-size: 0.95rem;">
            </div>
            <select id="filterVeredicto" onchange="aplicarFiltros()" style="padding: 0.75rem 1rem; border: 1px solid var(--gray-200); border-radius: 10px; background: white; font-size: 0.95rem; cursor: pointer; min-width: 180px;">
                <option value="TODOS">Todos los Veredictos</option>
                <option value="APTO">Solo Aptos</option>
                <option value="REVISI√ìN">En Revisi√≥n</option>
                <option value="NO APTO">No Aptos</option>
            </select>
            <div style="color: var(--gray-400); font-size: 0.85rem; font-weight: 500;">
                <span id="contadorCandidatos">{{ candidatos|length }}</span> candidatos encontrados
            </div>
        </div>

        <div class="problem-card" style="width: 100%; overflow-x: auto; border-radius: 16px; border: 1px solid var(--gray-200);">
            <table id="candidatosTable" style="width: 100%; border-collapse: collapse; text-align: left;">
                <thead>
                    <tr style="background: var(--gray-50); border-bottom: 2px solid var(--gray-200);">
                        <th style="padding: 1.25rem; color: var(--gray-700); font-weight: 600;">CANDIDATO</th>
                        <th style="padding: 1.25rem; color: var(--gray-700); font-weight: 600;">CONTACTO</th>
                        <th style="padding: 1.25rem; color: var(--gray-700); font-weight: 600;">SCORE / VEREDICTO</th>
                        <th style="padding: 1.25rem; color: var(--gray-700); font-weight: 600;">ACCIONES</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in candidatos %}
                    <tr class="candidato-row" style="border-bottom: 1px solid var(--gray-100); transition: 0.2s;">
                        <td style="padding: 1.25rem;">
                            <div class="nombre-candidato" style="font-weight: 600; color: var(--gray-900); font-size: 1rem;">{{ c.nombre_candidato }}</div>
                            <div style="font-size: 0.8rem; color: var(--gray-500); margin-top: 2px;">ID: {{ c.identificacion }}</div>
                        </td>
                        
                        <td style="padding: 1.25rem;">
                            <div style="font-size: 0.9rem; color: var(--gray-700); font-weight: 500;">{{ c.telefono if c.telefono else 'Sin Tel√©fono' }}</div>
                            <div style="font-size: 0.8rem; color: var(--primary-blue);">{{ c.email if c.email else '' }}</div>
                        </td>

                        <td style="padding: 1.25rem;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="score-mini {% if c.score|int >= 75 %}score-high{% elif c.score|int >= 50 %}score-medium{% else %}score-low{% endif %}" style="padding: 4px 10px; border-radius: 8px; font-weight: 700;">
                                    {{ c.score if c.score is not none else 0 }}%
                                </span>
                                <span class="veredicto-badge" style="color: var(--gray-600); background: var(--gray-100);">
                                    {{ c.veredicto }}
                                </span>
                            </div>
                        </td>

                        <td style="padding: 1.25rem; display: flex; gap: 0.5rem;">
                            <button onclick="verDetalle('{{ c.nombre_candidato }}', '{{ c.fortalezas }}', '{{ c.debilidades }}', '{{ c.analisis_ia }}', '{{ c.score }}', '{{ c.veredicto }}')" 
                                    class="btn-secondary" style="padding: 0.5rem 0.8rem; font-size: 0.8rem; display: flex; align-items: center; gap: 5px;">
                                üëÅÔ∏è Detalle
                            </button>

                            {% if c.telefono %}
                                <a href="https://wa.me/{{ c.telefono }}?text=Hola%20{{ c.nombre_candidato }},%20te%20contactamos%20de%20Sales%20AI..." target="_blank" 
                                   class="btn-primary" style="text-decoration: none; padding: 0.5rem 0.8rem; font-size: 0.8rem;">
                                    WhatsApp
                                </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            {% if not candidatos %}
            <div id="noDataMessage" style="padding: var(--spacing-2xl); text-align: center; color: var(--gray-500);">
                <p>No se encontraron candidatos evaluados.</p>
            </div>
            {% endif %}
        </div>
    </main>

    <div id="detalleModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="cerrarModal()">&times;</span>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <div>
                    <h2 id="modalNombre" style="margin: 0; color: var(--gray-900); font-size: 1.8rem;">Nombre</h2>
                    <p id="modalResumen" style="margin: 5px 0 0; color: var(--gray-500); font-weight: 500;">An√°lisis detallado de la entrevista</p>
                </div>
                <div id="modalScoreBadge" style="padding: 1rem 1.5rem; border-radius: 12px; text-align: center;">
                    <div style="font-size: 0.7rem; text-transform: uppercase; font-weight: 800; opacity: 0.8;">Score IA</div>
                    <div id="modalScoreValue" style="font-size: 1.5rem; font-weight: 900;">0%</div>
                </div>
            </div>

            <hr style="border: 0; border-top: 1px solid var(--gray-200); margin-bottom: 2rem;">

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div style="background: #f0fdf4; padding: 1.5rem; border-radius: 12px; border: 1px solid #dcfce7;">
                    <h4 style="margin-top: 0; color: #166534; display: flex; align-items: center; gap: 8px;">‚úÖ Fortalezas</h4>
                    <p id="modalFortalezas" style="color: #166534; line-height: 1.6; font-size: 0.95rem;"></p>
                </div>
                <div style="background: #fef2f2; padding: 1.5rem; border-radius: 12px; border: 1px solid #fee2e2;">
                    <h4 style="margin-top: 0; color: #991b1b; display: flex; align-items: center; gap: 8px;">‚ùå Debilidades</h4>
                    <p id="modalDebilidades" style="color: #991b1b; line-height: 1.6; font-size: 0.95rem;"></p>
                </div>
            </div>

            <div style="margin-top: 2rem; padding: 1.5rem; background: var(--gray-50); border-radius: 12px; border: 1px solid var(--gray-200);">
                <h4 style="margin-top: 0; color: var(--gray-700);">üí° An√°lisis Profundo (IA)</h4>
                <p id="modalAnalisis" style="color: var(--gray-600); line-height: 1.7; font-size: 1rem; font-style: italic;"></p>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container footer-bottom">
            <p>&copy; 2026 Sales AI - Sistema de Selecci√≥n Inteligente</p>
        </div>
    </footer>

    <script>
        // FUNCI√ìN FILTROS
        function aplicarFiltros() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const veredictoFilter = document.getElementById('filterVeredicto').value.toUpperCase();
            const rows = document.querySelectorAll('.candidato-row');
            let visibles = 0;

            rows.forEach(row => {
                const nombre = row.querySelector('.nombre-candidato').innerText.toLowerCase();
                const veredicto = row.querySelector('.veredicto-badge').innerText.toUpperCase();
                
                const matchesSearch = nombre.includes(searchText);
                const matchesVeredicto = (veredictoFilter === 'TODOS' || veredicto.includes(veredictoFilter));

                if (matchesSearch && matchesVeredicto) {
                    row.style.display = "";
                    visibles++;
                } else {
                    row.style.display = "none";
                }
            });

            document.getElementById('contadorCandidatos').innerText = visibles;
        }

        // FUNCI√ìN MODAL
        function verDetalle(nombre, fortalezas, debilidades, analisis, score, veredicto) {
            document.getElementById('modalNombre').innerText = nombre;
            document.getElementById('modalFortalezas').innerText = fortalezas || "No registradas";
            document.getElementById('modalDebilidades').innerText = debilidades || "No registradas";
            document.getElementById('modalAnalisis').innerText = analisis || "An√°lisis no disponible";
            document.getElementById('modalScoreValue').innerText = score + "%";
            
            // Ajustar color del badge del score en el modal
            const badge = document.getElementById('modalScoreBadge');
            const scoreInt = parseInt(score);
            if (scoreInt >= 75) {
                badge.style.background = "#d1fae5"; badge.style.color = "#065f46";
            } else if (scoreInt >= 50) {
                badge.style.background = "#fef3c7"; badge.style.color = "#92400e";
            } else {
                badge.style.background = "#fee2e2"; badge.style.color = "#991b1b";
            }

            document.getElementById('detalleModal').style.display = "block";
        }

        function cerrarModal() {
            document.getElementById('detalleModal').style.display = "none";
        }

        // Cerrar modal al hacer click fuera de √©l
        window.onclick = function(event) {
            const modal = document.getElementById('detalleModal');
            if (event.target == modal) {
                cerrarModal();
            }
        }
    </script>
</body>
</html>