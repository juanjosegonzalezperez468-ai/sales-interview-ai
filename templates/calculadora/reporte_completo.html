<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Completo ‚Äî {{ diagnostico.calculadora_leads.empresa }} ‚Äî Sales AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --ink: #0f1117;
            --slate: #374151;
            --muted: #6b7280;
            --line: #e5e7eb;
            --accent: #2563eb;
            --accent-light: #eff6ff;
            --green: #059669;
            --red: #dc2626;
            --amber: #d97706;
        }
        * { font-family: 'DM Sans', sans-serif; }
        .serif { font-family: 'DM Serif Display', serif; }
        body { background: #f8fafc; color: var(--ink); }
        .confirm-bar { background: linear-gradient(90deg, #059669 0%, #047857 100%); }
        .report-card { background: white; border-radius: 20px; box-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 1px 4px rgba(0,0,0,0.04); }
        .metric-hero { border-radius: 16px; padding: 24px; position: relative; overflow: hidden; }
        .metric-hero::before { content: ''; position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; border-radius: 50%; background: rgba(255,255,255,0.12); }
        .timeline-item { position: relative; padding-left: 40px; }
        .timeline-item::before { content: ''; position: absolute; left: 14px; top: 36px; width: 2px; height: calc(100% + 24px); background: var(--line); }
        .timeline-item:last-child::before { display: none; }
        .timeline-dot { position: absolute; left: 0; top: 20px; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: white; z-index: 1; }
        .action-row { border-bottom: 1px solid var(--line); }
        .action-row:last-child { border-bottom: none; }
        .badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 10px; border-radius: 100px; font-size: 11px; font-weight: 600; letter-spacing: 0.03em; }
        .btn-primary { background: var(--accent); color: white; border-radius: 12px; font-weight: 600; padding: 14px 28px; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary:hover { background: #1d4ed8; transform: translateY(-1px); box-shadow: 0 8px 20px rgba(37,99,235,0.3); }
        .btn-outline { border: 1.5px solid var(--line); color: var(--slate); border-radius: 12px; font-weight: 600; padding: 14px 28px; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; background: white; cursor: pointer; }
        .btn-outline:hover { border-color: var(--accent); color: var(--accent); }

        @media print {
            body { background: white !important; font-size: 11pt; }
            .no-print { display: none !important; }
            .confirm-bar { background: #059669 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .metric-hero { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .report-card { box-shadow: none !important; border: 1px solid #e5e7eb; }
            .page-break { page-break-before: always; }
            h1, h2, h3 { page-break-after: avoid; }
            .timeline-item { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

    <!-- Barra confirmaci√≥n -->
    <div class="confirm-bar text-white py-3 px-6 no-print">
        <div class="max-w-5xl mx-auto flex items-center justify-between flex-wrap gap-2">
            <div class="flex items-center gap-3">
                <div class="w-7 h-7 bg-white/20 rounded-full flex items-center justify-center">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <span class="font-semibold text-sm">Reporte completo desbloqueado ¬∑ Ref: {{ pago.ref_payco or pago.ref_interna }}</span>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="window.print()" class="flex items-center gap-2 text-sm bg-white/15 hover:bg-white/25 px-4 py-1.5 rounded-lg transition font-medium">
                    üìÑ Descargar PDF
                </button>
                <a href="/calculadora/resultados/{{ diagnostico.id }}" class="text-sm text-green-100 hover:text-white">‚Üê Ver diagn√≥stico</a>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-gray-100 py-5 px-6">
        <div class="max-w-5xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-gradient-to-br from-blue-500 to-blue-700 rounded-xl flex items-center justify-center text-white font-bold text-sm">S</div>
                <div>
                    <span class="text-lg font-bold text-gray-900">Sales AI</span>
                    <span class="text-gray-300 mx-2">¬∑</span>
                    <span class="text-sm text-gray-500">Reporte Completo de Reclutamiento</span>
                </div>
            </div>
            <div class="text-right">
                <p class="text-xs text-gray-400">Generado el</p>
                <p class="text-sm font-semibold text-gray-700">{{ diagnostico.created_at[:10] }}</p>
            </div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto px-4 py-10 space-y-8">

        <!-- PORTADA -->
        <div class="report-card p-10">
            <div class="flex items-start justify-between flex-wrap gap-6 mb-8">
                <div>
                    <p class="text-xs font-bold uppercase tracking-widest text-blue-500 mb-2">Diagn√≥stico de Reclutamiento</p>
                    <h1 class="serif text-4xl text-gray-900 mb-1">{{ diagnostico.calculadora_leads.empresa }}</h1>
                    <p class="text-gray-500">Para <strong>{{ diagnostico.calculadora_leads.nombre }}</strong> ¬∑ {{ diagnostico.calculadora_leads.cargo }}</p>
                </div>
                <div class="text-right">
                    {% set ef = diagnostico.eficiencia_total | round | int %}
                    <div class="inline-flex flex-col items-center justify-center w-24 h-24 rounded-2xl border-2
                        {% if ef >= 75 %}border-green-200 bg-green-50{% elif ef >= 50 %}border-amber-200 bg-amber-50{% else %}border-red-200 bg-red-50{% endif %}">
                        <span class="text-3xl font-black {% if ef >= 75 %}text-green-600{% elif ef >= 50 %}text-amber-600{% else %}text-red-600{% endif %}">{{ ef }}%</span>
                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wide mt-0.5">Eficiencia</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="metric-hero bg-blue-600 text-white">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-blue-200 mb-2">Costo Mensual Oculto</p>
                    <p class="text-2xl font-black">${{ "{:,.0f}".format(diagnostico.costo_operativo_mensual) }}</p>
                    <p class="text-xs text-blue-200 mt-1">USD/mes</p>
                </div>
                <div class="metric-hero bg-slate-700 text-white">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-slate-300 mb-2">Horas Perdidas</p>
                    <p class="text-2xl font-black">{{ diagnostico.horas_mensuales | round | int }}h</p>
                    <p class="text-xs text-slate-300 mt-1">por mes</p>
                </div>
                <div class="metric-hero bg-red-600 text-white">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-red-200 mb-2">Costo Errores/A√±o</p>
                    <p class="text-2xl font-black">${{ "{:,.0f}".format(diagnostico.costo_anual_errores) }}</p>
                    <p class="text-xs text-red-200 mt-1">USD/a√±o</p>
                </div>
                <div class="metric-hero bg-emerald-600 text-white">
                    <p class="text-[10px] font-bold uppercase tracking-widest text-emerald-200 mb-2">Ahorro Potencial</p>
                    <p class="text-2xl font-black">${{ "{:,.0f}".format(diagnostico.ahorro_anual) }}</p>
                    <p class="text-xs text-emerald-200 mt-1">USD/a√±o</p>
                </div>
            </div>
        </div>

        <!-- AN√ÅLISIS DETALLADO -->
        <div class="report-card p-8">
            <h2 class="serif text-2xl text-gray-900 mb-6 flex items-center gap-3">
                <span class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center text-sm">üìä</span>
                An√°lisis Detallado del Proceso
            </h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <p class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">Proceso Actual</p>
                    <div class="space-y-0">
                        {% for label, valor, estado in [
                            ('Candidatos/mes', diagnostico.total_cvs_mes ~ ' CVs', 'neutral'),
                            ('Tiempo por CV', diagnostico.tiempo_por_cv_min ~ ' minutos', 'bad' if diagnostico.tiempo_por_cv_min > 7 else 'neutral'),
                            ('Personas en proceso', diagnostico.personas_proceso_num ~ ' personas', 'neutral'),
                            ('Tasa de error', (diagnostico.tasa_error_decimal * 100)|round|int ~ '%', 'bad' if diagnostico.tasa_error_decimal > 0.2 else 'neutral'),
                            ('Vacantes activas', diagnostico.vacantes_activas, 'neutral'),
                        ] %}
                        <div class="flex items-center justify-between py-3 border-b border-gray-50">
                            <span class="text-sm text-gray-600">{{ label }}</span>
                            <span class="text-sm font-bold {% if estado == 'bad' %}text-red-600{% else %}text-gray-900{% endif %}">{{ valor }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="bg-emerald-50 rounded-2xl p-6 border border-emerald-100">
                    <p class="text-xs font-bold uppercase tracking-widest text-emerald-500 mb-4">Con Sales AI</p>
                    <div class="space-y-0">
                        {% for label, valor, delta in [
                            ('Horas/mes revisi√≥n', diagnostico.horas_optimizadas|round|int ~ ' h', '‚Üì 70%'),
                            ('Costo operativo', '$' ~ "{:,.0f}".format(diagnostico.costo_optimizado_mensual) ~ '/mes', '‚Üì 70%'),
                            ('Tasa de error', (diagnostico.tasa_error_optimizada * 100)|round|int ~ '%', '‚Üì 60%'),
                            ('Capacidad mensual', diagnostico.capacidad_aumentada ~ ' CVs', '‚Üë 233%'),
                            ('Ahorro mensual', '$' ~ "{:,.0f}".format(diagnostico.ahorro_mensual) ~ ' USD', 'üí∞'),
                        ] %}
                        <div class="flex items-center justify-between py-3 border-b border-emerald-100">
                            <span class="text-sm text-gray-700">{{ label }}</span>
                            <div class="flex items-center gap-2">
                                <span class="text-sm font-bold text-gray-900">{{ valor }}</span>
                                <span class="badge bg-emerald-100 text-emerald-700">{{ delta }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="mt-6 p-5 bg-red-50 rounded-xl border border-red-100 flex items-start gap-4">
                <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center text-lg flex-shrink-0">üö®</div>
                <div>
                    <p class="text-xs font-bold uppercase tracking-widest text-red-400 mb-1">Principal cuello de botella detectado</p>
                    <p class="font-bold text-red-900">{{ diagnostico.cuello_botella }}</p>
                    <p class="text-sm text-red-700 mt-1">Este punto concentra el mayor impacto en tiempo y costo de tu proceso actual.</p>
                </div>
            </div>
        </div>

        <!-- PLAN 90 D√çAS -->
        <div class="report-card p-8 page-break">
            <h2 class="serif text-2xl text-gray-900 mb-2 flex items-center gap-3">
                <span class="w-8 h-8 bg-purple-50 rounded-lg flex items-center justify-center text-sm">üó∫Ô∏è</span>
                Plan de Implementaci√≥n ‚Äî 90 D√≠as
            </h2>
            <p class="text-gray-500 text-sm mb-8">Hoja de ruta adaptada para <strong>{{ diagnostico.calculadora_leads.empresa }}</strong></p>

            <div class="space-y-6">
                <!-- Fase 1 -->
                <div class="timeline-item">
                    <div class="timeline-dot bg-blue-600">1</div>
                    <div class="bg-blue-50 border border-blue-100 rounded-2xl p-6">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="badge bg-blue-100 text-blue-700">D√≠as 1 ‚Äì 30</span>
                            <h3 class="font-bold text-gray-900 text-lg">Configuraci√≥n y Primera Vacante</h3>
                        </div>
                        <div class="grid md:grid-cols-2 gap-x-6">
                            {% for accion, prioridad, tiempo in [
                                ('Crear cuenta y configurar empresa en Sales AI', 'Alta', '1 hora'),
                                ('Definir skill stack para ' ~ diagnostico.vacantes_activas ~ ' vacante(s)', 'Alta', '2 horas'),
                                ('Publicar primera vacante con filtro IA activo', 'Alta', '30 min'),
                                ('Capacitar al equipo en lectura de scores IA', 'Media', '1 hora'),
                                ('Establecer score m√≠nimo de aprobaci√≥n (‚â•70%)', 'Media', '30 min'),
                            ] %}
                            <div class="flex items-start gap-3 py-3 border-b border-blue-100">
                                <div class="w-5 h-5 rounded-full border-2 border-blue-300 flex-shrink-0 mt-0.5"></div>
                                <div>
                                    <p class="text-sm text-gray-800">{{ accion }}</p>
                                    <div class="flex gap-2 mt-1">
                                        <span class="badge {% if prioridad == 'Alta' %}bg-red-100 text-red-600{% else %}bg-amber-100 text-amber-600{% endif %}">{{ prioridad }}</span>
                                        <span class="text-xs text-gray-400">‚è± {{ tiempo }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="mt-4 p-3 bg-white rounded-xl border border-blue-100">
                            <p class="text-xs font-bold text-blue-600 mb-1">üéØ Meta del mes 1</p>
                            <p class="text-sm text-gray-700">Primer candidato evaluado con IA y reducci√≥n visible en tiempo de revisi√≥n.</p>
                        </div>
                    </div>
                </div>

                <!-- Fase 2 -->
                <div class="timeline-item">
                    <div class="timeline-dot bg-purple-600">2</div>
                    <div class="bg-purple-50 border border-purple-100 rounded-2xl p-6">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="badge bg-purple-100 text-purple-700">D√≠as 31 ‚Äì 60</span>
                            <h3 class="font-bold text-gray-900 text-lg">Optimizaci√≥n del Pipeline</h3>
                        </div>
                        <div class="grid md:grid-cols-2 gap-x-6">
                            {% for accion, prioridad, tiempo in [
                                ('Activar entrevistas estructuradas post-filtro IA', 'Alta', '2 horas setup'),
                                ('Usar comparador para decisiones entre finalistas', 'Alta', 'Por proceso'),
                                ('Revisar scores de primeros 20+ candidatos y calibrar', 'Alta', '1 hora'),
                                ('Documentar patrones de √©xito por vacante', 'Media', '30 min/semana'),
                                ('Integrar CRM con estados Finalista / Contratado', 'Media', '1 hora'),
                            ] %}
                            <div class="flex items-start gap-3 py-3 border-b border-purple-100">
                                <div class="w-5 h-5 rounded-full border-2 border-purple-300 flex-shrink-0 mt-0.5"></div>
                                <div>
                                    <p class="text-sm text-gray-800">{{ accion }}</p>
                                    <div class="flex gap-2 mt-1">
                                        <span class="badge {% if prioridad == 'Alta' %}bg-red-100 text-red-600{% else %}bg-amber-100 text-amber-600{% endif %}">{{ prioridad }}</span>
                                        <span class="text-xs text-gray-400">‚è± {{ tiempo }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="mt-4 p-3 bg-white rounded-xl border border-purple-100">
                            <p class="text-xs font-bold text-purple-600 mb-1">üéØ Meta del mes 2</p>
                            <p class="text-sm text-gray-700">Reducir {{ diagnostico.horas_mensuales|round|int }}h ‚Üí {{ diagnostico.horas_optimizadas|round|int }}h de revisi√≥n. Primera contrataci√≥n con score IA validado.</p>
                        </div>
                    </div>
                </div>

                <!-- Fase 3 -->
                <div class="timeline-item">
                    <div class="timeline-dot bg-emerald-600">3</div>
                    <div class="bg-emerald-50 border border-emerald-100 rounded-2xl p-6">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="badge bg-emerald-100 text-emerald-700">D√≠as 61 ‚Äì 90</span>
                            <h3 class="font-bold text-gray-900 text-lg">Escala y Consolidaci√≥n</h3>
                        </div>
                        <div class="grid md:grid-cols-2 gap-x-6">
                            {% for accion, prioridad, tiempo in [
                                ('Expandir a todas las ' ~ diagnostico.vacantes_activas ~ ' vacante(s) activas', 'Alta', '2 horas'),
                                ('Revisar reportes y ajustar criterios de scoring', 'Alta', '1 hora/mes'),
                                ('Medir ROI real vs $' ~ "{:,.0f}".format(diagnostico.ahorro_mensual) ~ ' proyectados', 'Alta', '30 min'),
                                ('Entrenar equipo completo con casos reales', 'Media', '2 horas'),
                                ('Definir KPIs: tasa de aceptaci√≥n, tiempo a contrataci√≥n', 'Media', '1 hora'),
                            ] %}
                            <div class="flex items-start gap-3 py-3 border-b border-emerald-100">
                                <div class="w-5 h-5 rounded-full border-2 border-emerald-300 flex-shrink-0 mt-0.5"></div>
                                <div>
                                    <p class="text-sm text-gray-800">{{ accion }}</p>
                                    <div class="flex gap-2 mt-1">
                                        <span class="badge {% if prioridad == 'Alta' %}bg-red-100 text-red-600{% else %}bg-amber-100 text-amber-600{% endif %}">{{ prioridad }}</span>
                                        <span class="text-xs text-gray-400">‚è± {{ tiempo }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="mt-4 p-3 bg-white rounded-xl border border-emerald-100">
                            <p class="text-xs font-bold text-emerald-600 mb-1">üéØ Meta del mes 3</p>
                            <p class="text-sm text-gray-700">ROI comprobable: ahorro de ${{ "{:,.0f}".format(diagnostico.ahorro_mensual) }} USD/mes documentado. Proceso sistematizado al 100%.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resumen impacto -->
            <div class="mt-8 p-6 bg-gradient-to-r from-gray-900 to-slate-800 rounded-2xl text-white">
                <p class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-4">Impacto esperado a 90 d√≠as</p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <div>
                        <p class="text-3xl font-black">${{ "{:,.0f}".format(diagnostico.ahorro_mensual * 3) }}</p>
                        <p class="text-xs text-gray-400 mt-1">ahorro en 90 d√≠as</p>
                    </div>
                    <div>
                        <p class="text-3xl font-black text-emerald-400">-70%</p>
                        <p class="text-xs text-gray-400 mt-1">tiempo de revisi√≥n</p>
                    </div>
                    <div>
                        <p class="text-3xl font-black text-blue-400">{{ diagnostico.capacidad_aumentada }}</p>
                        <p class="text-xs text-gray-400 mt-1">CVs/mes procesables</p>
                    </div>
                    <div>
                        <p class="text-3xl font-black text-purple-400">{{ (diagnostico.tasa_error_optimizada * 100)|round|int }}%</p>
                        <p class="text-xs text-gray-400 mt-1">tasa de error objetivo</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- CTA FINAL -->
        <div class="report-card p-8 no-print">
            <div class="text-center max-w-xl mx-auto">
                <h2 class="serif text-2xl text-gray-900 mb-2">¬øListo para empezar?</h2>
                <p class="text-gray-500 mb-8">Crea tu cuenta y activa tu primera vacante en menos de 10 minutos.</p>
                <div class="flex flex-wrap items-center justify-center gap-4">
                    <a href="/registro?email={{ lead.email }}&empresa={{ lead.empresa }}" class="btn-primary text-base">
                        ‚ö° Crear mi cuenta gratis
                    </a>
                    <button onclick="window.print()" class="btn-outline text-base">
                        üìÑ Guardar como PDF
                    </button>
                </div>
                <p class="text-xs text-gray-400 mt-6">
                    ¬øPreguntas? <a href="mailto:hola@salesai.com" class="text-blue-500 hover:underline">hola@salesai.com</a>
                </p>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center py-6 text-xs text-gray-400">
            <p>¬© 2026 Sales AI ¬∑ Reporte para {{ diagnostico.calculadora_leads.empresa }} ¬∑ Confidencial</p>
            <p class="mt-1">Ref. de pago: {{ pago.ref_payco or pago.ref_interna }}</p>
        </div>

    </main>

    <script>
        fetch('/calculadora/api/tracking', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                diagnostico_id: '{{ diagnostico.id }}',
                tipo_interaccion: 'vio_reporte_completo',
                datos: { ref_pago: '{{ pago.ref_payco or pago.ref_interna }}' }
            })
        }).catch(() => {});
    </script>
</body>
</html>