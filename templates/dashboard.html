<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sales AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .sidebar-galaxy {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            position: relative;
        }
        .sidebar-galaxy::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(1px 1px at 20% 30%, white, transparent),
                radial-gradient(1px 1px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent);
            background-size: 200px 200px;
            opacity: 0.3;
            pointer-events: none;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .hover-lift:hover {
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .chart-container { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body class="bg-gray-50">
<div class="flex h-screen overflow-hidden">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <aside class="w-64 sidebar-galaxy text-white flex flex-col relative z-10">

        <!-- Logo -->
        <div class="p-6 flex items-center gap-3">
            <img
                src="{{ url_for('static', filename='img/logo-salesai.webp') }}"
                alt="Sales AI"
                class="h-10 w-auto"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
            >
            <div class="hidden items-center gap-2" style="display:none;">
                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-sm font-bold">S</div>
                <span class="text-lg font-bold">Sales AI</span>
            </div>
        </div>

        <!-- Navegaci√≥n -->
        <nav class="flex-1 px-3 py-4 space-y-1">

            <!-- Vacantes -->
            <a href="{{ url_for('gestionar_vacantes') }}"
               class="flex items-center gap-3 px-3 py-2.5 rounded-lg
               {{ 'bg-blue-600/20 border-l-4 border-blue-500 text-white font-medium' if request.path == '/gestionar_vacantes'
                  else 'text-gray-300 hover:bg-white/10 hover:text-white transition' }}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
                <span>Vacantes</span>
            </a>

            <!-- FIX 1: url_for('candidatos') ‚Äî funci√≥n correcta en app.py -->
            <a href="{{ url_for('candidatos') }}"
               class="flex items-center gap-3 px-3 py-2.5 rounded-lg transition
               {{ 'bg-blue-600/20 border-l-4 border-blue-500 text-white font-medium' if request.path == '/candidatos'
                  else 'text-gray-300 hover:bg-white/10 hover:text-white' }}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <span>Candidatos</span>
            </a>

            <!-- Reportes -->
            <a href="/reportes"
               class="flex items-center gap-3 px-3 py-2.5 rounded-lg
               {{ 'bg-blue-600/20 border-l-4 border-blue-500 text-white font-medium' if request.path == '/reportes'
                  else 'text-gray-300 hover:bg-white/10 hover:text-white transition' }}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                <span>Reportes</span>
            </a>

            <!-- Calculadora ROI -->
            <a href="/calculadora/"
               class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-300 hover:bg-white/10 hover:text-white transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                </svg>
                <span>Calculadora ROI</span>
            </a>

            <!-- Plantillas -->
            <a href="/marketplace"
               class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-300 hover:bg-white/10 hover:text-white transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
                <span>Plantillas</span>
            </a>

            <!-- Empresa -->
            <a href="#"
               class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-300 hover:bg-white/10 hover:text-white transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                </svg>
                <span>Empresa</span>
            </a>
        </nav>

        <!-- Empresa y Usuario -->
        <div class="p-4 border-t border-white/10 space-y-3">
            <div class="flex items-center gap-2 text-sm text-gray-400 px-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                </svg>
                <span>{{ nombre_empresa }}</span>
            </div>

            <div class="flex items-center gap-3 px-2 py-2 rounded-lg bg-white/5">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-sm font-bold">
                    {{ usuario.nombre_completo[0] if usuario else 'A' }}
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-white truncate">{{ usuario.nombre_completo if usuario else 'Admin' }}</p>
                    <p class="text-xs text-gray-400">Admin</p>
                </div>
                <a href="/logout" class="text-gray-400 hover:text-white transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                </a>
            </div>
        </div>
    </aside>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIN SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTENIDO PRINCIPAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <main class="flex-1 overflow-y-auto custom-scrollbar">

        <!-- Header -->
        <header class="bg-white border-b border-gray-200 px-8 py-5 sticky top-0 z-10">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-gray-900">
                    Hola, {{ usuario.nombre_completo.split()[0] if usuario else 'Admin' }} üëã
                </h1>
                <div class="flex items-center gap-4">
                    <button class="relative p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                        </svg>
                        {% if total_c > 0 %}
                        <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                        {% endif %}
                    </button>
                </div>
            </div>
        </header>

        <!-- M√©tricas -->
        <div class="p-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">

                <!-- Vacantes Activas -->
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 border border-blue-200 hover-lift fade-in">
                    <div class="flex items-start justify-between mb-4">
                        <div class="p-3 bg-blue-500 rounded-xl">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                        </div>
                    </div>
                    <p class="text-sm text-blue-700 font-medium mb-1">Vacantes Activas</p>
                    <p class="text-4xl font-bold text-blue-900 mb-1">{{ total_v }}</p>
                    <p class="text-xs text-blue-600">Abiertas y activas</p>
                </div>

                <!-- Candidatos Evaluados -->
                <div class="bg-gradient-to-br from-teal-50 to-teal-100 rounded-2xl p-6 border border-teal-200 hover-lift fade-in" style="animation-delay:0.1s;">
                    <div class="flex items-start justify-between mb-4">
                        <div class="p-3 bg-teal-500 rounded-xl">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                            </svg>
                        </div>
                    </div>
                    <p class="text-sm text-teal-700 font-medium mb-1">Candidatos Evaluados</p>
                    <p class="text-4xl font-bold text-teal-900 mb-1">{{ total_c }}</p>
                    <p class="text-xs text-teal-600">Analizados con IA</p>
                </div>

                <!-- Tasa de Filtrado -->
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-6 border border-purple-200 hover-lift fade-in" style="animation-delay:0.2s;">
                    <div class="flex items-start justify-between mb-4">
                        <div class="p-3 bg-purple-500 rounded-xl">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                        </div>
                    </div>
                    <p class="text-sm text-purple-700 font-medium mb-1">Tasa de Filtrado IA</p>
                    <p class="text-4xl font-bold text-purple-900 mb-1">
                        {% if total_c > 0 %}
                            {{ ((entrevistas | selectattr('veredicto', 'equalto', 'RECOMENDADO') | list | length / total_c) * 100) | round | int }}%
                        {% else %}
                            0%
                        {% endif %}
                    </p>
                    <p class="text-xs text-purple-600">Filtrados autom√°ticamente</p>
                </div>
            </div>

            <!-- Tabla de candidatos -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between gap-4 flex-wrap">
                    <h2 class="text-xl font-bold text-gray-900">√öltimos Candidatos Evaluados</h2>
                    <div class="flex items-center gap-3 flex-wrap">
                        <!-- Filtros de estado -->
                        <div class="flex items-center gap-1 bg-gray-100 rounded-xl p-1">
                            <button onclick="filtrarEstado('todos')" id="filtro-todos"
                                    class="filtro-btn px-3 py-1.5 rounded-lg text-xs font-bold transition bg-white text-gray-700 shadow-sm">
                                Todos
                            </button>
                            <button onclick="filtrarEstado('Finalista')" id="filtro-Finalista"
                                    class="filtro-btn px-3 py-1.5 rounded-lg text-xs font-bold transition text-gray-500 hover:text-gray-700">
                                ‚≠ê Finalista
                            </button>
                            <button onclick="filtrarEstado('Contratado')" id="filtro-Contratado"
                                    class="filtro-btn px-3 py-1.5 rounded-lg text-xs font-bold transition text-gray-500 hover:text-gray-700">
                                üèÜ Contratado
                            </button>
                            <button onclick="filtrarEstado('Descartado')" id="filtro-Descartado"
                                    class="filtro-btn px-3 py-1.5 rounded-lg text-xs font-bold transition text-gray-500 hover:text-gray-700">
                                ‚úï Descartado
                            </button>
                        </div>
                        <a href="/nueva_vacante"
                           class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Crear Vacante
                        </a>
                    </div>
                </div>

                {% if total_c == 0 %}
                <div class="p-16 text-center">
                    <div class="inline-block p-6 bg-blue-50 rounded-full mb-4">
                        <svg class="w-12 h-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900">No hay candidatos a√∫n</h3>
                    <p class="text-gray-500 mb-6">Configura una vacante para empezar a recibir an√°lisis.</p>
                    <a href="/nueva_vacante" class="text-blue-600 font-bold hover:underline">Configurar mi primera vacante ‚Üí</a>
                </div>

                {% else %}
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Candidato</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Cargo</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Score IA</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Veredicto</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Estado</th>
                                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-600 uppercase">Acciones</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            {% for candidato in entrevistas[:10] %}
                            <tr class="fila-candidato hover:bg-gray-50 transition"
                                data-estado="{{ candidato.estado or '' }}">

                                <!-- FIX 2: campo correcto es candidato.nombre (no nombre_candidato) -->
                                <td class="px-6 py-4">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-xs uppercase">
                                            {{ candidato.nombre[0] if candidato.nombre else 'U' }}
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900">{{ candidato.nombre }}</p>
                                            <p class="text-xs text-gray-500">ID: {{ candidato.id[:8] }}</p>
                                        </div>
                                    </div>
                                </td>

                                <!-- cargo ya resuelto en app.py -->
                                <td class="px-6 py-4 text-sm text-gray-600">
                                    {{ candidato.cargo }}
                                </td>

                                <td class="px-6 py-4">
                                    <span class="text-lg font-bold text-gray-900">{{ candidato.score }}%</span>
                                </td>

                                <td class="px-6 py-4 text-sm">
                                    {% if candidato.veredicto == 'RECOMENDADO' %}
                                        <span class="px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs font-medium">Apto</span>
                                    {% elif candidato.veredicto == 'REVISAR' %}
                                        <span class="px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 text-xs font-medium">Revisar</span>
                                    {% else %}
                                        <span class="px-2 py-1 rounded-full bg-red-100 text-red-800 text-xs font-medium">Descartado</span>
                                    {% endif %}
                                </td>

                                <!-- Celda Estado -->
                                <td class="px-6 py-4">
                                    {% if candidato.estado == 'Finalista' %}
                                        <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs font-bold">‚≠ê Finalista</span>
                                    {% elif candidato.estado == 'Contratado' %}
                                        <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-blue-100 text-blue-700 text-xs font-bold">üèÜ Contratado</span>
                                    {% elif candidato.estado == 'Descartado' %}
                                        <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-red-100 text-red-700 text-xs font-bold">‚úï Descartado</span>
                                    {% else %}
                                        <span class="text-xs text-gray-300 italic">‚Äî</span>
                                    {% endif %}
                                </td>

                                <td class="px-6 py-4 text-right">
                                    <div class="flex justify-end gap-2">
                                        <button onclick="verAnalisis('{{ candidato.id }}')"
                                                class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition"
                                                title="Ver an√°lisis">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0zM2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}

            </div><!-- fin tabla -->
        </div><!-- fin p-8 -->
    </main>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIN CONTENIDO PRINCIPAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

</div><!-- fin flex h-screen -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL DE AN√ÅLISIS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="modal-analisis" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl">

        <!-- Header modal -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-6 flex items-center justify-between text-white">
            <div class="flex items-center gap-4">
                <div id="modal-avatar"
                     class="w-16 h-16 rounded-full bg-white/20 backdrop-blur flex items-center justify-center text-2xl font-bold">
                    A
                </div>
                <div>
                    <h2 id="modal-nombre" class="text-2xl font-bold">Cargando...</h2>
                    <p class="text-blue-100 text-sm">ID: <span id="modal-id">---</span></p>
                </div>
            </div>
            <button onclick="cerrarModal()" class="p-2 hover:bg-white/20 rounded-lg transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>

        <!-- Score y metadata -->
        <div class="px-8 py-6 bg-gray-50 border-b border-gray-200">
            <!-- Evoluci√≥n visual Fase 2 (oculta hasta que haya evaluaci√≥n) -->
            <div id="evolucion-scores" class="hidden mb-4 p-4 bg-blue-50 border border-blue-100 rounded-xl">
                <p class="text-[10px] font-black uppercase text-blue-400 tracking-widest mb-3">Evoluci√≥n del Candidato</p>
                <div class="flex items-center gap-3 flex-wrap mb-4">
                    <div class="text-center">
                        <p class="text-xs text-gray-500 mb-1">Pre-evaluaci√≥n</p>
                        <p id="ev-score-pre" class="text-2xl font-black text-gray-700">‚Äî</p>
                    </div>
                    <div class="text-gray-300 text-2xl font-light">‚Üí</div>
                    <div class="text-center">
                        <p class="text-xs text-gray-500 mb-1">Entrevista</p>
                        <p id="ev-score-interview" class="text-2xl font-black text-blue-600">‚Äî</p>
                    </div>
                    <div class="text-gray-300 text-2xl font-light">‚Üí</div>
                    <div class="text-center bg-blue-600 rounded-xl px-4 py-2">
                        <p class="text-xs text-blue-200 mb-1">Score Final</p>
                        <p id="ev-score-final" class="text-2xl font-black text-white">‚Äî</p>
                    </div>
                </div>

                <!-- Fortalezas y alertas de entrevista -->
                <div id="obs-entrevista" class="hidden grid grid-cols-1 md:grid-cols-2 gap-3 pt-3 border-t border-blue-100">
                    <!-- Fortalezas confirmadas -->
                    <div id="bloque-fortalezas-ev" class="hidden">
                        <p class="text-[10px] font-black uppercase text-emerald-500 tracking-widest mb-2">
                            ‚úì Fortalezas confirmadas en entrevista
                        </p>
                        <ul id="lista-fortalezas-ev" class="space-y-1"></ul>
                    </div>
                    <!-- Alertas detectadas -->
                    <div id="bloque-alertas-ev" class="hidden">
                        <p class="text-[10px] font-black uppercase text-amber-500 tracking-widest mb-2">
                            ‚ö† Alerta detectada
                        </p>
                        <ul id="lista-alertas-ev" class="space-y-1"></ul>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-4 gap-6">
                <div class="text-center">
                    <p class="text-sm text-gray-600 mb-2">Score Global</p>
                    <div class="relative inline-block">
                        <svg class="w-24 h-24 transform -rotate-90">
                            <circle cx="48" cy="48" r="40" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                            <circle id="modal-score-circle" cx="48" cy="48" r="40" stroke="#3b82f6" stroke-width="8"
                                    fill="none" stroke-dasharray="251.2" stroke-dashoffset="0"
                                    class="transition-all duration-1000"/>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span id="modal-score-text" class="text-2xl font-bold text-gray-900">0%</span>
                        </div>
                    </div>
                </div>
                <div>
                    <p class="text-sm text-gray-600 mb-2">Cargo</p>
                    <p id="modal-cargo" class="font-semibold text-gray-900">---</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600 mb-2">Veredicto</p>
                    <span id="modal-veredicto-badge"
                          class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                        <span id="modal-tag">üü°</span>
                        <span id="modal-veredicto">---</span>
                    </span>
                </div>
                <div>
                    <p class="text-sm text-gray-600 mb-2">Fecha</p>
                    <p id="modal-fecha" class="font-semibold text-gray-900">---</p>
                </div>
            </div>
        </div>

        <!-- Contenido scrolleable -->
        <div class="overflow-y-auto max-h-[60vh] custom-scrollbar">

            <!-- Gr√°fica Radar -->
            <div class="px-8 py-6 bg-gradient-to-br from-blue-50 to-purple-50 border-b border-gray-200">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    <h3 class="text-lg font-bold text-gray-900">An√°lisis por Categor√≠as</h3>
                </div>
                <div class="chart-container bg-white rounded-xl p-4 shadow-sm">
                    <canvas id="graficaCandidato"></canvas>
                </div>
            </div>

            <!-- Resumen ejecutivo -->
            <div class="px-8 py-6 border-b border-gray-200">
                <div class="flex items-center gap-2 mb-3">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <h3 class="text-lg font-bold text-gray-900">Resumen Ejecutivo</h3>
                </div>
                <p id="modal-resumen" class="text-gray-700 leading-relaxed">Cargando an√°lisis...</p>
            </div>

            <!-- Fortalezas -->
            <div class="px-8 py-6 bg-gradient-to-br from-green-50 to-emerald-50 border-b border-gray-200">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <h3 class="text-lg font-bold text-green-900">Fortalezas Detectadas</h3>
                </div>
                <div id="modal-fortalezas" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- Riesgos -->
            <div class="px-8 py-6 bg-yellow-50 border-b border-gray-200">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    <h3 class="text-lg font-bold text-yellow-900">Riesgos / Debilidades</h3>
                </div>
                <ul id="modal-riesgos" class="space-y-2">
                    <li class="flex items-start gap-2 text-yellow-800">
                        <span class="text-yellow-600 mt-1">‚Ä¢</span>
                        <span>Cargando...</span>
                    </li>
                </ul>
            </div>

            <!-- Respuestas detalladas -->
            <div class="px-8 py-6">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    <h3 class="text-lg font-bold text-gray-900">Respuestas Detalladas</h3>
                </div>
                <div id="modal-respuestas" class="space-y-3">
                    <p class="text-gray-500">Cargando respuestas...</p>
                </div>
            </div>

            <!-- Recomendaci√≥n final -->
            <div class="px-8 py-6 bg-blue-50 border-t border-gray-200">
                <div class="flex items-center gap-2 mb-3">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    <h3 class="text-lg font-bold text-blue-900">Recomendaci√≥n</h3>
                </div>
                <p id="modal-recomendacion" class="text-blue-800 font-medium">---</p>
            </div>

        </div><!-- fin scroll -->


            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 FASE 2 ‚Äî EVALUACI√ìN POST-ENTREVISTA
            ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div class="px-8 py-6 border-t border-gray-200">
                <div class="flex items-center gap-2 mb-2">
                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                    <h3 class="text-lg font-bold text-gray-900">Evaluaci√≥n Post-Entrevista</h3>
                    <span id="badge-evaluado" class="hidden ml-2 px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded-full">‚úì Evaluado</span>
                </div>

                <!-- Frase anti-sesgo -->
                <p class="text-xs text-slate-400 italic mb-5 pl-1">
                    "Eval√∫a lo que observaste, no lo que esperabas."
                </p>

                <div id="form-evaluacion" class="space-y-6 mb-6">

                    <!-- BLOQUE A: Competencia T√©cnica (40%) -->
                    <div class="bg-blue-50 border border-blue-100 rounded-2xl p-4">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-[10px] font-black uppercase text-blue-400 tracking-widest">Bloque A</p>
                                <p class="text-sm font-bold text-blue-800">Validaci√≥n de Competencia</p>
                            </div>
                            <span class="text-xs bg-blue-100 text-blue-600 font-bold px-2 py-1 rounded-full">40%</span>
                        </div>
                        <div class="space-y-4">
                            <!-- Criterio 1 -->
                            <div class="criterio-row">
                                <div class="flex items-center justify-between mb-1">
                                    <label class="text-sm font-semibold text-gray-700">üì¶ Dominio pr√°ctico del rol</label>
                                    <span id="val-dominio" class="text-lg font-black text-blue-600 w-6 text-center">3</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] text-gray-400">1</span>
                                    <input type="range" min="1" max="5" value="3" step="1"
                                           id="crit-dominio" oninput="actualizarCrit(this)"
                                           class="flex-1 accent-blue-600 h-2">
                                    <span class="text-[10px] text-gray-400">5</span>
                                </div>
                                <div class="flex justify-between text-[10px] text-gray-300 mt-0.5 px-3">
                                    <span>Muy d√©bil</span><span>Excelente</span>
                                </div>
                            </div>
                            <!-- Criterio 2 -->
                            <div class="criterio-row">
                                <div class="flex items-center justify-between mb-1">
                                    <label class="text-sm font-semibold text-gray-700">üß© Resoluci√≥n de escenarios reales</label>
                                    <span id="val-resolucion" class="text-lg font-black text-blue-600 w-6 text-center">3</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] text-gray-400">1</span>
                                    <input type="range" min="1" max="5" value="3" step="1"
                                           id="crit-resolucion" oninput="actualizarCrit(this)"
                                           class="flex-1 accent-blue-600 h-2">
                                    <span class="text-[10px] text-gray-400">5</span>
                                </div>
                                <div class="flex justify-between text-[10px] text-gray-300 mt-0.5 px-3">
                                    <span>Muy d√©bil</span><span>Excelente</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BLOQUE B: Habilidades Conductuales (60%) -->
                    <div class="bg-purple-50 border border-purple-100 rounded-2xl p-4">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-[10px] font-black uppercase text-purple-400 tracking-widest">Bloque B</p>
                                <p class="text-sm font-bold text-purple-800">Validaci√≥n Conductual</p>
                            </div>
                            <span class="text-xs bg-purple-100 text-purple-600 font-bold px-2 py-1 rounded-full">60%</span>
                        </div>
                        <div class="space-y-4">
                            <!-- Criterio 3 -->
                            <div class="criterio-row">
                                <div class="flex items-center justify-between mb-1">
                                    <label class="text-sm font-semibold text-gray-700">üí¨ Comunicaci√≥n y claridad</label>
                                    <span id="val-comunicacion" class="text-lg font-black text-purple-600 w-6 text-center">3</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] text-gray-400">1</span>
                                    <input type="range" min="1" max="5" value="3" step="1"
                                           id="crit-comunicacion" oninput="actualizarCrit(this)"
                                           class="flex-1 accent-purple-600 h-2">
                                    <span class="text-[10px] text-gray-400">5</span>
                                </div>
                                <div class="flex justify-between text-[10px] text-gray-300 mt-0.5 px-3">
                                    <span>Muy d√©bil</span><span>Excelente</span>
                                </div>
                            </div>
                            <!-- Criterio 4 -->
                            <div class="criterio-row">
                                <div class="flex items-center justify-between mb-1">
                                    <label class="text-sm font-semibold text-gray-700">üß† Pensamiento estructurado</label>
                                    <span id="val-pensamiento" class="text-lg font-black text-purple-600 w-6 text-center">3</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] text-gray-400">1</span>
                                    <input type="range" min="1" max="5" value="3" step="1"
                                           id="crit-pensamiento" oninput="actualizarCrit(this)"
                                           class="flex-1 accent-purple-600 h-2">
                                    <span class="text-[10px] text-gray-400">5</span>
                                </div>
                                <div class="flex justify-between text-[10px] text-gray-300 mt-0.5 px-3">
                                    <span>Muy d√©bil</span><span>Excelente</span>
                                </div>
                            </div>
                            <!-- Criterio 5 -->
                            <div class="criterio-row">
                                <div class="flex items-center justify-between mb-1">
                                    <label class="text-sm font-semibold text-gray-700">ü§ù Alineaci√≥n cultural</label>
                                    <span id="val-cultura" class="text-lg font-black text-purple-600 w-6 text-center">3</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] text-gray-400">1</span>
                                    <input type="range" min="1" max="5" value="3" step="1"
                                           id="crit-cultura" oninput="actualizarCrit(this)"
                                           class="flex-1 accent-purple-600 h-2">
                                    <span class="text-[10px] text-gray-400">5</span>
                                </div>
                                <div class="flex justify-between text-[10px] text-gray-300 mt-0.5 px-3">
                                    <span>Muy d√©bil</span><span>Excelente</span>
                                </div>
                            </div>
                            <!-- Criterio 6 -->
                            <div class="criterio-row">
                                <div class="flex items-center justify-between mb-1">
                                    <label class="text-sm font-semibold text-gray-700">‚ö° Seguridad y criterio profesional</label>
                                    <span id="val-seguridad" class="text-lg font-black text-purple-600 w-6 text-center">3</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-[10px] text-gray-400">1</span>
                                    <input type="range" min="1" max="5" value="3" step="1"
                                           id="crit-seguridad" oninput="actualizarCrit(this)"
                                           class="flex-1 accent-purple-600 h-2">
                                    <span class="text-[10px] text-gray-400">5</span>
                                </div>
                                <div class="flex justify-between text-[10px] text-gray-300 mt-0.5 px-3">
                                    <span>Muy d√©bil</span><span>Excelente</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comentario opcional -->
                    <div>
                        <label class="text-xs font-bold uppercase text-gray-400 tracking-widest">Comentario del entrevistador (opcional)</label>
                        <textarea id="eval-comentario" rows="2" placeholder="Observaciones espec√≠ficas de la entrevista..."
                                  class="mt-1 w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm
                                         focus:ring-2 focus:ring-purple-400 outline-none resize-none"></textarea>
                    </div>

                    <button onclick="guardarEvaluacion()"
                            id="btn-guardar-eval"
                            class="w-full py-3 bg-purple-600 hover:bg-purple-700 active:scale-95 text-white
                                   font-black rounded-xl transition-all tracking-widest uppercase text-sm shadow-lg shadow-purple-200">
                        Guardar Evaluaci√≥n de Entrevista
                    </button>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                 FASE 2 ‚Äî ESTADO DEL CANDIDATO
            ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div class="px-8 py-6 bg-gray-50 border-t border-gray-200">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                    </svg>
                    <h3 class="text-base font-bold text-gray-900">Decisi√≥n Final</h3>
                    <span id="estado-actual-badge" class="hidden ml-auto text-xs font-bold px-3 py-1 rounded-full"></span>
                </div>
                <div class="grid grid-cols-3 gap-3" id="botones-estado">
                    <button onclick="cambiarEstado('Finalista')"
                            id="btn-finalista"
                            class="estado-btn py-3 px-4 rounded-xl border-2 border-emerald-200 bg-emerald-50
                                   hover:bg-emerald-500 hover:text-white hover:border-emerald-500
                                   text-emerald-700 font-bold text-sm transition-all active:scale-95">
                        ‚≠ê Finalista
                    </button>
                    <button onclick="cambiarEstado('Descartado')"
                            id="btn-descartado"
                            class="estado-btn py-3 px-4 rounded-xl border-2 border-red-200 bg-red-50
                                   hover:bg-red-500 hover:text-white hover:border-red-500
                                   text-red-700 font-bold text-sm transition-all active:scale-95">
                        ‚úï Descartado
                    </button>
                    <button onclick="cambiarEstado('Contratado')"
                            id="btn-contratado"
                            class="estado-btn py-3 px-4 rounded-xl border-2 border-blue-200 bg-blue-50
                                   hover:bg-blue-600 hover:text-white hover:border-blue-600
                                   text-blue-700 font-bold text-sm transition-all active:scale-95">
                        üèÜ Contratado
                    </button>
                </div>
            </div>

        <!-- Footer modal -->
        <div class="px-8 py-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between">
            <p class="text-xs text-gray-500">
                <span class="font-medium">M√©todo:</span>
                <span id="modal-metodo">Evaluaci√≥n l√≥gica automatizada</span>
            </p>
            <div class="flex items-center gap-3">
                <button onclick="cerrarModal()"
                        class="px-4 py-2 text-gray-700 hover:bg-gray-200 rounded-lg font-medium transition">
                    Cerrar
                </button>
                <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                    </svg>
                    Descargar PDF
                </button>
            </div>
        </div>

    </div><!-- fin modal card -->
</div><!-- fin modal overlay -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCRIPTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
    let graficaActual = null;

    function extraerMetricas(analisisObj) {
        if (!analisisObj) {
            return { tecnica: 50, experiencia: 50, blandas: 50, ajuste: 50 };
        }
        const numFortalezas = (analisisObj.fortalezas || []).length;
        const numRiesgos    = (analisisObj.riesgos || []).filter(r => r !== 'Sin riesgos identificados').length;
        const valor = Math.min(100, Math.max(0, 50 + numFortalezas * 10 - numRiesgos * 8));
        return {
            tecnica:     Math.round(valor * 0.95),
            experiencia: Math.round(valor * 1.0),
            blandas:     Math.round(valor * 0.90),
            ajuste:      Math.min(100, Math.round(valor * 1.05))
        };
    }

    function dibujarGrafica(analisisObj) {
        const datos = extraerMetricas(analisisObj);
        const ctx   = document.getElementById('graficaCandidato').getContext('2d');
        if (graficaActual) { graficaActual.destroy(); }

        graficaActual = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['T√©cnicas', 'Experiencia', 'Blandas', 'Cultura'],
                datasets: [{
                    label: 'Puntaje',
                    data: [datos.tecnica, datos.experiencia, datos.blandas, datos.ajuste],
                    backgroundColor: 'rgba(59,130,246,0.2)',
                    borderColor:     'rgba(59,130,246,1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(59,130,246,1)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(59,130,246,1)',
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                layout: { padding: { top: 30, right: 30, bottom: 30, left: 30 } },
                scales: {
                    r: {
                        beginAtZero: true, max: 100, min: 0,
                        ticks: {
                            stepSize: 25,
                            callback: v => v + '%',
                            font: { size: 11 },
                            color: '#6b7280'
                        },
                        grid:       { color: 'rgba(0,0,0,0.1)' },
                        angleLines: { color: 'rgba(0,0,0,0.1)' },
                        pointLabels: { font: { size: 13, weight: '600' }, color: '#374151', padding: 15 }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        enabled: true,
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        padding: 12,
                        titleFont: { size: 14, weight: 'bold' },
                        bodyFont:  { size: 13 },
                        callbacks: {
                            title: ctx => ({
                                'T√©cnicas':    'Habilidades T√©cnicas',
                                'Experiencia': 'Experiencia',
                                'Blandas':     'Habilidades Blandas',
                                'Cultura':     'Ajuste Cultural'
                            })[ctx[0].label] || ctx[0].label,
                            label: ctx => 'Puntaje: ' + ctx.parsed.r.toFixed(1) + '%'
                        }
                    }
                }
            }
        });
    }

    function verAnalisis(candidatoId) {
        candidatoIdActual = candidatoId;
        document.getElementById('modal-analisis').classList.remove('hidden');
        // Reset Fase 2 UI al abrir nuevo candidato
        document.getElementById('badge-evaluado').classList.add('hidden');
        document.getElementById('evolucion-scores').classList.add('hidden');
        document.getElementById('obs-entrevista').classList.add('hidden');
        document.getElementById('bloque-fortalezas-ev').classList.add('hidden');
        document.getElementById('bloque-alertas-ev').classList.add('hidden');
        document.getElementById('estado-actual-badge').classList.add('hidden');
        document.querySelectorAll('.estado-btn').forEach(b => b.classList.remove('ring-2','ring-offset-1'));
        const btnEval = document.getElementById('btn-guardar-eval');
        btnEval.textContent = 'Guardar Evaluaci√≥n de Entrevista';
        btnEval.disabled = false;
        btnEval.className = btnEval.className.replace('bg-green-600','bg-purple-600').replace('hover:bg-green-700','hover:bg-purple-700');
        // Resetear sliders a 5
        ['dominio','resolucion','comunicacion','pensamiento','cultura','seguridad'].forEach(k => {
            const s = document.getElementById('crit-' + k);
            const v = document.getElementById('val-' + k);
            if (s) s.value = 3;
            if (v) v.textContent = 3;
        });
        document.getElementById('eval-comentario').value = '';

        fetch(`/api/candidato/${candidatoId}`)
            .then(res => res.json())
            .then(data => {
                // Avatar e info b√°sica
                document.getElementById('modal-avatar').textContent  = data.nombre.charAt(0).toUpperCase();
                document.getElementById('modal-nombre').textContent  = data.nombre;
                document.getElementById('modal-id').textContent      = data.identificacion;
                document.getElementById('modal-cargo').textContent   = data.cargo;
                document.getElementById('modal-fecha').textContent   = data.fecha;

                // Score circular
                const score = data.score;
                const offset = 251.2 - (score / 100) * 251.2;
                document.getElementById('modal-score-text').textContent = score + '%';
                const circulo = document.getElementById('modal-score-circle');
                circulo.style.strokeDashoffset = offset;
                circulo.style.stroke = score >= 75 ? '#10b981' : score >= 40 ? '#f59e0b' : '#ef4444';

                // Veredicto
                document.getElementById('modal-tag').textContent      = data.tag;
                document.getElementById('modal-veredicto').textContent = data.veredicto;
                const badge = document.getElementById('modal-veredicto-badge');
                badge.className = 'inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium';
                badge.classList.add(
                    data.veredicto.includes('RECOMENDADO') ? 'bg-green-100' :
                    data.veredicto.includes('REVISAR')     ? 'bg-yellow-100' : 'bg-red-100',
                    data.veredicto.includes('RECOMENDADO') ? 'text-green-800' :
                    data.veredicto.includes('REVISAR')     ? 'text-yellow-800' : 'text-red-800'
                );

                // Gr√°fica
                if (data.analisis) { dibujarGrafica(data.analisis); }

                // Textos del an√°lisis
                const analisis = data.analisis || {};
                document.getElementById('modal-resumen').textContent       = analisis.resumen       || 'Sin an√°lisis disponible';
                document.getElementById('modal-recomendacion').textContent = analisis.recomendacion || 'Validar manualmente';
                document.getElementById('modal-metodo').textContent        = analisis.metodo        || 'Evaluaci√≥n automatizada';

                // Fortalezas
                const colores = [
                    'bg-green-100 text-green-800 border-green-300',
                    'bg-blue-100 text-blue-800 border-blue-300',
                    'bg-purple-100 text-purple-800 border-purple-300',
                    'bg-teal-100 text-teal-800 border-teal-300',
                    'bg-indigo-100 text-indigo-800 border-indigo-300',
                ];
                const fortalezasHTML = (analisis.fortalezas || []).map((f, i) => {
                    const texto = f.replace(/^[‚úì‚úî]?\s*/, '');
                    return `<span class="inline-flex items-center gap-2 px-4 py-2 rounded-full border-2 ${colores[i % colores.length]} font-medium text-sm shadow-sm hover:shadow-md transition-shadow cursor-default">
                        <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        <span>${texto}</span>
                    </span>`;
                }).join('');
                document.getElementById('modal-fortalezas').innerHTML = fortalezasHTML ||
                    '<span class="text-gray-500 italic text-sm">Sin fortalezas destacadas en esta evaluaci√≥n</span>';

                // Riesgos
                const riesgosHTML = (analisis.riesgos || []).map(r =>
                    `<li class="flex items-start gap-2 text-yellow-800">
                        <svg class="w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                        <span>${r}</span>
                    </li>`
                ).join('');
                document.getElementById('modal-riesgos').innerHTML = riesgosHTML ||
                    '<li class="text-gray-500">Sin riesgos identificados</li>';

                // Cargar Fase 2: evaluaci√≥n y estado
                cargarEvaluacion(data.evaluacion, data.score_interview, data.score_final_combinado, data.score);
                cargarEstado(data.estado);

                // Respuestas
                const respuestasHTML = (data.respuestas || []).map(r => {
                    const puntos = r.puntos || 0;
                    const peso   = r.peso   || 0;
                    const esAbierta = r.tipo === 'abierta';
                    let colorClase, iconHTML;
                    if (esAbierta) {
                        colorClase = 'bg-blue-50 border-blue-200';
                        iconHTML   = '<span class="text-2xl">üìù</span>';
                    } else if (puntos === peso && peso > 0) {
                        colorClase = 'bg-green-50 border-green-200';
                        iconHTML   = '<span class="text-2xl">‚úÖ</span>';
                    } else if (puntos === 0) {
                        colorClase = 'bg-red-50 border-red-200';
                        iconHTML   = '<span class="text-2xl">‚ùå</span>';
                    } else {
                        colorClase = 'bg-yellow-50 border-yellow-200';
                        iconHTML   = '<span class="text-2xl">‚ö†Ô∏è</span>';
                    }
                    return `<div class="border rounded-lg p-4 ${colorClase}">
                        <div class="flex items-start justify-between gap-4 mb-2">
                            <div class="flex-1">
                                <p class="font-semibold text-gray-900 mb-1">${r.pregunta}</p>
                                <p class="text-gray-700">${r.respuesta}</p>
                            </div>
                            <div class="text-right flex-shrink-0">
                                ${iconHTML}
                                ${!esAbierta
                                    ? `<p class="text-sm font-bold text-gray-900 mt-1">${puntos}/${peso} pts</p>`
                                    : '<p class="text-xs text-gray-500 mt-1">Revisi√≥n manual</p>'}
                            </div>
                        </div>
                    </div>`;
                }).join('');
                document.getElementById('modal-respuestas').innerHTML = respuestasHTML ||
                    '<p class="text-gray-500">Sin respuestas registradas</p>';
            })
            .catch(err => {
                console.error('Error cargando an√°lisis:', err);
                document.getElementById('modal-resumen').textContent = 'Error al cargar el an√°lisis';
            });
    }

    function cerrarModal() {
        document.getElementById('modal-analisis').classList.add('hidden');
        if (graficaActual) { graficaActual.destroy(); graficaActual = null; }
    }

    function eliminarCandidato(candidatoId) {
        if (!confirm('¬øEst√°s seguro de eliminar este candidato?')) return;
        fetch(`/eliminar_candidato/${candidatoId}`, { method: 'POST' })
            .then(res => res.json())
            .then(data => { if (data.success) { location.reload(); } else { alert('Error al eliminar'); } });
    }


    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // FASE 2 ‚Äî EVALUACI√ìN POST-ENTREVISTA
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let candidatoIdActual = null;

    // Actualizar valor visual de cada slider
    function actualizarCrit(input) {
        const key = input.id.replace('crit-', '');
        document.getElementById('val-' + key).textContent = input.value;
    }


    // Mapa de criterios ‚Üí texto legible para fortalezas/alertas
    const CRITERIO_LABELS = {
        dominio:      'Dominio pr√°ctico del rol',
        resolucion:   'Resoluci√≥n de escenarios reales',
        comunicacion: 'Comunicaci√≥n y claridad',
        pensamiento:  'Pensamiento estructurado',
        cultura:      'Alineaci√≥n cultural',
        seguridad:    'Seguridad y criterio profesional',
    };

    function generarObsEntrevista(criterios) {
        if (!criterios) return;

        const fortalezas = [];
        const alertas    = [];

        for (const [key, val] of Object.entries(criterios)) {
            const label = CRITERIO_LABELS[key] || key;
            if (val >= 4) fortalezas.push(label);
            else if (val <= 2) alertas.push(label);
        }

        const bloqF = document.getElementById('bloque-fortalezas-ev');
        const bloqA = document.getElementById('bloque-alertas-ev');
        const obsEl = document.getElementById('obs-entrevista');

        // Fortalezas
        if (fortalezas.length > 0) {
            bloqF.classList.remove('hidden');
            document.getElementById('lista-fortalezas-ev').innerHTML =
                fortalezas.map(f =>
                    `<li class="flex items-center gap-1.5 text-xs text-emerald-700 font-medium">
                        <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 shrink-0"></span>${f}
                    </li>`
                ).join('');
        } else {
            bloqF.classList.add('hidden');
        }

        // Alertas
        if (alertas.length > 0) {
            bloqA.classList.remove('hidden');
            document.getElementById('lista-alertas-ev').innerHTML =
                alertas.map(a =>
                    `<li class="flex items-center gap-1.5 text-xs text-amber-700 font-medium">
                        <span class="w-1.5 h-1.5 rounded-full bg-amber-400 shrink-0"></span>${a}
                    </li>`
                ).join('');
        } else {
            bloqA.classList.add('hidden');
        }

        // Mostrar bloque si hay algo que mostrar
        if (fortalezas.length > 0 || alertas.length > 0) {
            obsEl.classList.remove('hidden');
        } else {
            obsEl.classList.add('hidden');
        }
    }

    // Precargar evaluaci√≥n si ya existe
    function cargarEvaluacion(evaluacion, scoreInterview, scoreFinalCombinado, scorePreEval) {
        if (!evaluacion || !evaluacion.criterios) return;

        document.getElementById('badge-evaluado').classList.remove('hidden');

        // Llenar sliders con valores guardados (6 criterios, escala 1-5)
        const mapa = {
            dominio:      evaluacion.criterios.dominio,
            resolucion:   evaluacion.criterios.resolucion,
            comunicacion: evaluacion.criterios.comunicacion,
            pensamiento:  evaluacion.criterios.pensamiento,
            cultura:      evaluacion.criterios.cultura,
            seguridad:    evaluacion.criterios.seguridad,
        };
        for (const [key, val] of Object.entries(mapa)) {
            if (val !== undefined) {
                const slider = document.getElementById('crit-' + key);
                const label  = document.getElementById('val-' + key);
                if (slider) { slider.value = val; }
                if (label)  { label.textContent = val; }
            }
        }
        if (evaluacion.comentario) {
            document.getElementById('eval-comentario').value = evaluacion.comentario;
        }

        // Mostrar evoluci√≥n de scores
        if (scoreInterview !== null && scoreFinalCombinado !== null) {
            document.getElementById('evolucion-scores').classList.remove('hidden');
            document.getElementById('ev-score-pre').textContent      = scorePreEval + '%';
            document.getElementById('ev-score-interview').textContent = (scoreInterview / 20).toFixed(1) + ' / 5';
            document.getElementById('ev-score-final').textContent     = scoreFinalCombinado + '%';
        }

        // Generar fortalezas/alertas basadas en criterios
        generarObsEntrevista(evaluacion.criterios);
    }

    // Cargar estado visual del candidato
    function cargarEstado(estado) {
        if (!estado) return;
        const badge = document.getElementById('estado-actual-badge');
        badge.classList.remove('hidden');

        const config = {
            'Finalista':  { text: '‚≠ê Finalista',  cls: 'bg-emerald-100 text-emerald-700', btnId: 'btn-finalista'  },
            'Descartado': { text: '‚úï Descartado', cls: 'bg-red-100 text-red-700',         btnId: 'btn-descartado' },
            'Contratado': { text: 'üèÜ Contratado', cls: 'bg-blue-100 text-blue-700',       btnId: 'btn-contratado' },
        };
        const cfg = config[estado];
        if (cfg) {
            badge.textContent = cfg.text;
            badge.className   = 'ml-auto text-xs font-bold px-3 py-1 rounded-full ' + cfg.cls;
            // Resaltar bot√≥n activo
            document.querySelectorAll('.estado-btn').forEach(b => b.classList.remove('ring-2', 'ring-offset-1'));
            const btnActivo = document.getElementById(cfg.btnId);
            if (btnActivo) btnActivo.classList.add('ring-2', 'ring-offset-1');
        }
    }

    // Guardar evaluaci√≥n post-entrevista
    async function guardarEvaluacion() {
        if (!candidatoIdActual) return;

        const criterios = {
            // Bloque A: Competencia T√©cnica (40%)
            dominio:      parseInt(document.getElementById('crit-dominio').value),
            resolucion:   parseInt(document.getElementById('crit-resolucion').value),
            // Bloque B: Conductual (60%)
            comunicacion: parseInt(document.getElementById('crit-comunicacion').value),
            pensamiento:  parseInt(document.getElementById('crit-pensamiento').value),
            cultura:      parseInt(document.getElementById('crit-cultura').value),
            seguridad:    parseInt(document.getElementById('crit-seguridad').value),
        };
        const comentario = document.getElementById('eval-comentario').value;

        const btn = document.getElementById('btn-guardar-eval');
        btn.textContent = 'Guardando...';
        btn.disabled    = true;

        try {
            const res  = await fetch('/api/guardar_evaluacion', {
                method:  'POST',
                headers: { 'Content-Type': 'application/json' },
                body:    JSON.stringify({ entrevista_id: candidatoIdActual, criterios, comentario })
            });
            const data = await res.json();

            if (data.status === 'success') {
                // Mostrar evoluci√≥n actualizada
                const scorePreEl = document.getElementById('modal-score-text').textContent;
                const scorePre   = parseInt(scorePreEl);
                document.getElementById('evolucion-scores').classList.remove('hidden');
                document.getElementById('ev-score-pre').textContent       = scorePre + '%';
                document.getElementById('ev-score-interview').textContent  = (data.score_interview / 20).toFixed(1) + ' / 5';
                document.getElementById('ev-score-final').textContent      = data.score_final_combinado + '%';

                // Generar fortalezas/alertas con los criterios reci√©n guardados
                generarObsEntrevista(criterios);
                document.getElementById('badge-evaluado').classList.remove('hidden');
                btn.textContent = '‚úì Evaluaci√≥n Guardada';
                btn.classList.replace('bg-purple-600', 'bg-green-600');
                btn.classList.replace('hover:bg-purple-700', 'hover:bg-green-700');
                setTimeout(() => {
                    btn.textContent = 'Actualizar Evaluaci√≥n';
                    btn.disabled    = false;
                }, 2500);
            } else {
                alert('Error al guardar: ' + (data.error || 'Error desconocido'));
                btn.textContent = 'Guardar Evaluaci√≥n de Entrevista';
                btn.disabled    = false;
            }
        } catch (err) {
            console.error(err);
            btn.textContent = 'Guardar Evaluaci√≥n de Entrevista';
            btn.disabled    = false;
        }
    }

    // Cambiar estado del candidato
    async function cambiarEstado(nuevoEstado) {
        if (!candidatoIdActual) return;
        try {
            const res = await fetch('/actualizar_estado', {
                method:  'POST',
                headers: { 'Content-Type': 'application/json' },
                body:    JSON.stringify({ id: candidatoIdActual, estado: nuevoEstado })
            });
            const data = await res.json();
            if (data.status === 'success') {
                cargarEstado(nuevoEstado);
            }
        } catch (err) {
            console.error('Error actualizando estado:', err);
        }
    }


    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // FILTRO POR ESTADO EN TABLA
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function filtrarEstado(estado) {
        // Actualizar botones activos
        document.querySelectorAll('.filtro-btn').forEach(btn => {
            btn.classList.remove('bg-white', 'text-gray-700', 'shadow-sm');
            btn.classList.add('text-gray-500');
        });
        const btnActivo = document.getElementById('filtro-' + estado);
        if (btnActivo) {
            btnActivo.classList.add('bg-white', 'text-gray-700', 'shadow-sm');
            btnActivo.classList.remove('text-gray-500');
        }

        // Filtrar filas
        document.querySelectorAll('.fila-candidato').forEach(fila => {
            const estadoFila = fila.dataset.estado || '';
            if (estado === 'todos' || estadoFila === estado) {
                fila.style.display = '';
            } else {
                fila.style.display = 'none';
            }
        });
    }

    document.addEventListener('keydown', e => { if (e.key === 'Escape') cerrarModal(); });
</script>

</body>
</html>